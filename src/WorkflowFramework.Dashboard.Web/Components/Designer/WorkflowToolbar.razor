<div class="flex items-center gap-2 px-4 py-2 bg-gray-800 border-b border-gray-700" data-testid="toolbar">
    <input type="text" value="@WorkflowName"
           data-testid="workflow-name"
           @oninput="e => OnWorkflowNameChanged.InvokeAsync(e.Value?.ToString() ?? string.Empty)"
           class="bg-gray-700 text-white px-3 py-1 rounded text-sm font-semibold w-56 focus:outline-none focus:ring-2 focus:ring-blue-500" />

    @if (IsDirty)
    {
        <span class="text-yellow-400 text-xs">â—</span>
    }

    <div class="w-px h-6 bg-gray-600 mx-1"></div>

    <button @onclick="OnNew" class="toolbar-btn" title="New" data-testid="btn-new">ğŸ“„ New</button>
    <button @onclick="OnOpen" class="toolbar-btn" title="Open" data-testid="btn-open">ğŸ“‚ Open</button>
    <button @onclick="OnSave" class="toolbar-btn" title="Save" data-testid="btn-save">ğŸ’¾ Save</button>
    <button @onclick="OnTemplates" class="toolbar-btn" title="New from Template" data-testid="btn-templates">ğŸ“‹ Templates</button>

    <div class="w-px h-6 bg-gray-600 mx-1"></div>

    <button @onclick="OnValidate" class="toolbar-btn text-blue-400 relative" title="Validate" data-testid="btn-validate">
        ğŸ” Validate
        @if (ValidationErrorCount > 0)
        {
            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] rounded-full w-4 h-4 flex items-center justify-center" data-testid="validation-badge">@ValidationErrorCount</span>
        }
    </button>
    <button @onclick="OnRun" class="toolbar-btn text-green-400" title="Run" data-testid="btn-run">â–¶ Run</button>

    <div class="w-px h-6 bg-gray-600 mx-1"></div>

    <button @onclick="OnFitView" class="toolbar-btn" title="Fit View" data-testid="btn-fit">ğŸ” Fit</button>
    <button @onclick="OnExportJson" class="toolbar-btn" title="Export JSON" data-testid="btn-export-json" data-testid2="btn-export">ğŸ“¤ JSON</button>
    <button @onclick="OnExportYaml" class="toolbar-btn" title="Export YAML" data-testid="btn-export-yaml">ğŸ“¤ YAML</button>
    <label class="toolbar-btn cursor-pointer" title="Import" data-testid="btn-import">
        ğŸ“¥ Import
        <InputFile OnChange="OnImportFile" style="display:none" accept=".json,.yaml,.yml" />
    </label>

    <div class="flex-1"></div>

    <ThemeToggle />
    <button @onclick="OnSettings" class="toolbar-btn" title="Settings">âš™ï¸</button>
    <button @onclick="OnShortcutsHelp" class="toolbar-btn" title="Keyboard Shortcuts (?)">âŒ¨ï¸</button>

    <span class="text-gray-500 text-xs">WorkflowFramework Designer</span>
</div>

@code {
    [Parameter] public string WorkflowName { get; set; } = "";
    [Parameter] public EventCallback<string> OnWorkflowNameChanged { get; set; }
    [Parameter] public bool IsDirty { get; set; }
    [Parameter] public EventCallback OnNew { get; set; }
    [Parameter] public EventCallback OnOpen { get; set; }
    [Parameter] public EventCallback OnSave { get; set; }
    [Parameter] public EventCallback OnRun { get; set; }
    [Parameter] public EventCallback OnExportJson { get; set; }
    [Parameter] public EventCallback OnExportYaml { get; set; }
    [Parameter] public EventCallback<InputFileChangeEventArgs> OnImportFile { get; set; }
    [Parameter] public EventCallback OnFitView { get; set; }
    [Parameter] public EventCallback OnTemplates { get; set; }
    [Parameter] public EventCallback OnValidate { get; set; }
    [Parameter] public int ValidationErrorCount { get; set; }
    [Parameter] public EventCallback OnSettings { get; set; }
    [Parameter] public EventCallback OnShortcutsHelp { get; set; }
}
